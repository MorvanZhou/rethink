import unittest

from retk import const
from retk.core.ai import llm
from . import utils
from .test_ai_llm_api import skip_no_api_key, clear_all_api_key

md_source = """\
广东猪脚饭特点

广州猪脚饭超越沙县小吃兰州拉面等，成为广东第一中式快餐。

原因是

1. 广东人口分布有很多外来人口，猪脚饭兼容了很多口味
2. 工艺简单，大量的预制工作，较低出餐时间，出餐快。适合快节奏的打工人群
3. 因为出餐快，所以不用招人，省人力成本

![IMG6992.png](https://files.rethink.run/userData/RroFuzYSd8NGoKRL5zrrkZ/3a4344ccd6ba477e59ddf1f7f67e98bd.png)

更值得一提的是猪脚饭在广东便宜，其它地方贵，原因之一是可以从香港走私猪脚，因为外国人不吃，所以产能过剩

【猪脚饭如何成为广东的快餐之王？【食录】-哔哩哔哩】 https://b23.tv/YUlg1nN
"""

md_summary = """\
标题：广东猪脚饭的快餐特色与成功因素

知识点：
1. **市场接受度**：广东猪脚饭因兼容多种口味，受到广泛欢迎，超越沙县小吃和兰州拉面成为广东最受欢迎的中式快餐。
2. **人口结构**：广东的外来人口众多，猪脚饭满足了不同地域人群的口味需求。
3. **工艺优势**：猪脚饭的制作工艺简单，预制工作量大，出餐速度快，适合快节奏生活。
4. **成本效益**：快速出餐减少了人力成本，提高了经营效率。
5. **价格因素**：猪脚饭在广东价格低廉，部分原因是可能通过香港走私猪脚，利用外国人不吃猪脚导致的产能过剩。
"""


class LLMKnowledgeExtendTest(unittest.IsolatedAsyncioTestCase):
    @classmethod
    def setUpClass(cls):
        cls.sid = "testid"
        cls.skey = "testkey"
        utils.set_env(".env.test.local")

    @classmethod
    def tearDownClass(cls) -> None:
        utils.drop_env(".env.test.local")

    def tearDown(self):
        clear_all_api_key()

    @skip_no_api_key
    async def test_summary(self):
        for service, model in [
            (llm.api.TencentService(), llm.api.TencentModelEnum.HUNYUAN_LITE),
            (llm.api.AliyunService(), llm.api.AliyunModelEnum.QWEN1_5_05B),
            (llm.api.BaiduService(), llm.api.BaiduModelEnum.ERNIE_SPEED_8K),
            # (llm.api.OpenaiService(), llm.api.OpenaiModelEnum.GPT4),
            (llm.api.XfYunService(), llm.api.XfYunModelEnum.SPARK_LITE),
            (llm.api.MoonshotService(), llm.api.MoonshotModelEnum.V1_8K),  # 这个总结比较好
        ]:
            text, code = await llm.knowledge.summary(
                llm_service=service,
                model=model.value,
                query=md_source,
            )
            self.assertEqual(const.CodeEnum.OK, code, msg=text)
            print(f"{service.__class__.__name__} {model.value}\n{text}\n\n")

    # summary
    """
    TencentService hunyuan-lite
    # 广东猪脚饭特点

    广州猪脚饭超越沙县小吃、兰州拉面等，成为广东第一中式快餐。

    原因：

    1. **口味多样**：广东人口分布有很多外来人口，猪脚饭兼容了很多口味，适应不同人群的需求。

    2. **工艺简单**：猪脚饭的制作工艺相对简单，大量预制工作，使得出餐时间较短，满足快节奏打工人群的需求。

    3. **低成本**：猪脚饭出餐快，不需要招人，节省人力成本，降低了餐厅运营成本。

    4. **价格优势**：广东地区的猪脚饭价格相对较低，其中一个原因是可以从香港走私猪脚，因为外国人不吃，导致产能过剩。

    综上所述，广东猪脚饭凭借多样化的口味、简单的制作工艺、低成本和高性价比，成功成为广东的快餐之王。


    AliyunService qwen1.5-0.5b-chat
    标题：广东猪脚饭为何能成为中式快餐之王？

    知识点：
    1. **特点**：广大的劳动力和价格优势使猪脚饭成为了广东地区著名的中式快餐之一。
    2. **原因**：广州猪脚饭的独特之处在于其符合当地人的口味，简单工艺、快速出餐和无需招工，且具有良好的性价比。
    3. **香港影响**：广东猪脚饭与其他食品如沙县小吃、兰州拉面等有着密切联系，且上海等地的饮食文化对广东菜的影响也不可忽视。

    请务必确认所有内容是准确无误的，如有疑问欢迎与我交流。


    BaiduService ernie_speed
    标题：广东猪脚饭的特点与成为快餐之王的缘由

    知识点：

    1. 特点：
       - 广泛适应性：猪脚饭在广东受到欢迎，因为它兼容多种口味，适应了广东地区大量外来人口的口味需求。
       - 出餐快速：猪脚饭制作工艺简单，预制工作量大，出餐时间短，适合快节奏的工作环境。
       - 价格优势：在广东地区，猪脚饭价格相对便宜，部分原因是由于可以从香港走私猪脚，由于外国人不吃猪脚，导致猪脚产能过剩。

    2. 成为快餐之王的原因：
       - 多样化口味：适应多种口味需求，满足不同人群的需求。
       - 制作效率：简单的制作工艺和大量的预制工作使得出餐速度极快。
       - 成本低廉：低人力成本和原材料成本的优势，使得猪脚饭价格更具竞争力。
       - 地域文化：广东地区的饮食文化和外来人口的融合，为猪脚饭提供了广阔的市场空间。

    附加信息：

    - 视频链接：【猪脚饭如何成为广东的快餐之王？【食录】】（可通过此链接了解更多关于猪脚饭的信息）。
    - 其它相关介绍：除了文中提到的特点外，猪脚饭还有丰富的营养价值和美味口感，是广东地区非常受欢迎的中式快餐之一。


    XfYunService v1.1
    广东猪脚饭的特点有以下几点：1. 猪脚饭是一种传统的粤菜，口感鲜美，营养丰富。2. 猪脚饭的制作工艺简单，出餐速度快，适合快节奏的打工人群。3.


    MoonshotService moonshot-v1-8k
    标题：广东猪脚饭成为快餐之王的原因

    知识点：
    1. **口味兼容**：广东猪脚饭适合多种口味，适应了广东外来人口的饮食习惯。
    2. **工艺简易**：猪脚饭制作流程简单，有大量预制工作，便于快速出餐。
    3. **快节奏适应**：快速出餐的特点迎合了快节奏的打工人群需求。
    4. **成本节省**：出餐快减少了人力需求，降低了人力成本。
    5. **价格优势**：广东猪脚饭价格便宜，部分原因是可能通过香港走私猪脚以降低成本。

    """

    @skip_no_api_key
    async def test_extend(self):
        for service, model in [
            # (llm.api.TencentService(), llm.api.TencentModelEnum.HUNYUAN_PRO),
            (llm.api.AliyunService(), llm.api.AliyunModelEnum.QWEN_PLUS),
            # (llm.api.BaiduService(), llm.api.BaiduModelEnum.ERNIE_SPEED_8K),
            # (llm.api.OpenaiService(), llm.api.OpenaiModelEnum.GPT4),
            # (llm.api.XfYunService(), llm.api.XfYunModelEnum.SPARK_LITE),
            # (llm.api.MoonshotService(), llm.api.MoonshotModelEnum.V1_8K),   # 这个延伸比较好
        ]:
            text, code = await llm.knowledge.extend(
                llm_service=service,
                model=model.value,
                query=md_summary,
            )
            self.assertEqual(const.CodeEnum.OK, code, msg=text)
            print(f"{service.__class__.__name__} {model.value}\n{text}\n\n")

    # extend
    """
    TencentService hunyuan-pro
    基于你提供的知识点，我为你推荐以下新知识：

    **新知识**：中国地方特色美食文化的传播与影响

    * **背景**：随着全球化和人口流动的加速，中国各地的特色美食文化得以广泛传播。广东猪脚饭的成功不仅反映了其独特的快餐特色，也体现了中国地方美食在传播过程中的影响力。
    * **传播途径**：现代社交媒体、美食节目、以及外出就餐等途径使得人们更容易接触到不同地区的特色美食。
    * **文化交融**：在传播过程中，地方特色美食往往会与当地文化和其他美食文化发生交融，形成新的风味和吃法。
    * **经济影响**：特色美食的传播不仅丰富了人们的饮食选择，也为相关产业链带来了经济效益。例如，猪脚饭的成功带动了相关食材（如猪脚）的生产和销售。
    * **社会影响**：美食文化的传播有助于加强地区间的文化交流和理解，增进人们对不同生活方式的认识和尊重。

    这一新知识将帮助你更全面地了解中国地方特色美食文化的传播过程及其所带来的多方面影响。


    AliyunService qwen1.5-0.5b-chat
    广东猪脚饭的快餐特色与成功因素：

    1. 市场接受度高：广东的猪脚饭在多个地区都有着广泛的受欢迎程度，这得益于其多元化的口味选择，适应不同地域人们的口味需求。
    2. 人口结构多样：广东本地的人口丰富多样，使得广东猪脚饭具有了较好的多元化口味，满足了不同地域人群的需求。
    3. 工艺优势：广东的猪脚饭的制作工艺相对简单，符合中国菜的特点，预制工作量大，易于加工，出餐速度快，保证了效率。
    4. 成本效益：快速出餐节省了人力成本，提高了经营效率，降低了运营成本。
    5. 价格因素：广东猪脚饭的价格在短时间内下降了很多，主要是由于采用了快速出餐的方式，影响了商品的销量。
    
    AliyunService qwen-plus
    新知识：预制菜产业的发展与影响
    
    - 预制菜是餐饮行业中的一种趋势，它包括预先准备好的食材、半成品或成品菜肴，方便快捷地供消费者加热或简单烹饪后食用。
    - **效率提升**：预制菜大大缩短了餐厅的烹饪时间，提高了服务速度，尤其适合快餐业和外卖市场的需求。
    - **风味标准化**：预制菜使得菜品的味道更加统一，有助于连锁餐饮品牌保持品质一致性。
    - **食品安全**：预制菜生产过程中严格的质量控制提升了食品安全标准，降低了餐饮业的食品安全风险。
    - **饮食文化变化**：预制菜的流行也反映了现代人生活节奏加快，对便利性需求增加的社会现象，同时也引发关于食物新鲜度和营养流失的讨论。
    - **产业链影响**：预制菜产业的发展带动了上游食材供应链、冷链物流及包装材料等相关行业的发展。


    BaiduService ernie_speed
    基于上述知识点，为您推荐的新知识是：

    **广东猪脚饭连锁经营与品牌发展策略**

    1. **连锁经营趋势**：随着市场需求的增长，广东猪脚饭逐渐兴起连锁经营的模式，这种模式带来了品牌效应和市场占有率的提高。
    2. **品牌建设重要性**：在竞争激烈的市场环境下，建立品牌成为猪脚饭行业发展的关键。通过品牌建设，可以提升消费者忠诚度，增加市场议价能力。
    3. **创新与差异化策略**：在保持传统口味的基础上，部分猪脚饭品牌开始尝试新的菜品、配料和口味创新，以吸引年轻消费者群体。同时，注重提供优质的服务和环境设施，打造独特的用餐体验。
    4. **市场拓展与营销策略**：随着互联网的普及，广东猪脚饭品牌开始利用社交媒体、短视频等渠道进行营销，扩大品牌影响力。同时，通过合作、加盟等方式拓展市场，提高市场份额。
    5. **食品安全与质量控制**：随着连锁经营和品牌建设的深入，食品安全和质量控制成为关键挑战。品牌需要建立严格的食品安全管理体系，确保食材的新鲜和卫生，提高消费者的信任度。


    XfYunService v1.1
    广东猪脚饭的成功因素有很多，其中包括市场接受度、人口结构、工艺优势、成本效益和价格因素等。广东猪脚饭因兼容多种口味，受到广泛欢迎，超越沙县小吃和兰州拉面成为广东最受欢迎的中式快餐。广东的外来人口众多，猪脚饭满足了不同地域人群的口味需求。猪脚饭的制作工艺简单，预制工作量大，出餐速度快，适合快节奏生活。快速出餐减少了人力成本，提高了经营效率。


    MoonshotService moonshot-v1-8k
    # 你需要返回的新知识

    广东早茶文化与粤式饮食特色

    - **文化背景**：广东早茶不仅仅是一种饮食习惯，它代表了广东人悠闲的生活方式和社交文化。早茶通常在上午进行，人们聚在一起品尝点心、喝茶，享受悠闲时光。
    - **粤式饮食特色**：粤菜是中国八大菜系之一，以其精致的烹饪技艺、丰富的食材选择和清淡的口味而闻名。广东早茶中的点心种类繁多，如虾饺、烧卖、肠粉等，每一道都是对食材和工艺的极致追求。
    - **社交功能**：早茶不仅仅是满足口腹之欲，更是亲朋好友相聚、商务洽谈的社交场所。这种饮食文化体现了广东人重视人际关系和社交活动的特点。
    - **经济发展**：随着广东经济的快速发展，早茶文化也得到了进一步的推广和发展。现代的早茶店不仅提供传统的点心，还融入了创新元素，满足不同顾客的需求。
    - **旅游吸引力**：广东早茶作为一种独特的饮食文化，吸引了大量国内外游客前来体验。它不仅丰富了广东的旅游产品，也为当地经济发展做出了贡献。
    """
